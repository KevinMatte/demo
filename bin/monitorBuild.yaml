# This sets up default values for all following targets.
# The __defaults__ for one YAML file are NOT passed onto the next.
"__defaults__":
  # When the file in '--skip_file {file}' exists, these commands are run rather than the 'commands'
  skipped:
    - "bin/say.py '_MONITOR_NAME_: Skip file exists. Skipping.' 2>/dev/null"

  # Executed before running 'commands'
  started:
    - "bin/say.py '_MONITOR_NAME_: Starting' 2>/dev/null"

  # Executed after running 'commands' successfully.
  completed:
    - "make build_done"
    - "bin/say.py '_MONITOR_NAME_: Completed' 2>/dev/null"

  # Executed after running 'commands' failed.
  error:
    - "bin/say.py '_MONITOR_NAME_: Error' 2>/dev/null"

  # Fall-back commands if 'commands' is not specified.
  commands:
    - "bin/say.py '_MONITOR_NAME_: Missing commands' 2>/dev/null"

# This is the start of a declaration of files/paths to monitor and commands to execute.
"static and environment":

  # When a file/path changes, these commands will be executed.
  commands:
    - "make update_dot_env"
    - "make -C images/demo_ui"
    - "make update_dot_env"
    - "make -C images/demo_ui build_static"

  # A list of files/paths and file name patterns to monitor.
  searches:
    # Not used. Just nice to see.
    - name: 'static'
      # A list of paths to directories or files.
      paths: ["images/demo_ui/src/static"]
      # Optional. If given, the full path must match this python regular expression.
      # You could include directories in these patterns, but if possible, don't, I think.
      patterns: ['.*\.js$', '.*\.jsx$', '.*\.css$', '.*\.htm$l', '.*\.py$', '.*\.php$']

    # A search example without patterns.
    - name: 'environment'
      paths: ['.env', '.secrets.env']

"demo_ui front":
  commands:
    - "make -C images/demo_ui build_front"
  searches:
    - name: 'Front UI'
      paths: ["images/demo_ui/src/front"]
      patterns: ['.*\.jsx$', '.*\.css$', '.*\.html$']
