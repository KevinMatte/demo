# See also monitorBuild.yaml which is a uncommented version of this file.
#
# This sets up default values for all following targets.
# The __defaults__ for one YAML file are NOT passed onto the next.
#
# Note: A list of one string in the YAML can be replaced with the one string for easier reading.
"__defaults__":
  # When the file in '--skip_file {file}' exists, these commands are run rather than the 'commands'
  skipped: "bin/say.py '_MONITOR_NAME_: Skip file exists. Skipping.' 2>/dev/null"

  # Executed before running 'commands'
  started: "bin/say.py '_MONITOR_NAME_: Starting' 2>/dev/null"

  # Executed after running 'commands' successfully.
  completed:
    - "make build_done"
    - "rm -f tmp/build.locked"
    - "bin/say.py '_MONITOR_NAME_: Completed' 2>/dev/null"

  # Executed after running 'commands' failed.
  error:
    - "rm -f tmp/build.locked"
    - "bin/say.py '_MONITOR_NAME_: Error' 2>/dev/null"

  # Fall-back commands if 'commands' is not specified.
  # Note: A single string is recognized as a short form of a list of one string.
  commands: "bin/say.py '_MONITOR_NAME_: Missing commands' 2>/dev/null"

# This is the start of a declaration of files/paths to monitor and commands to execute.
"UI Sources":

  # When a file/path changes, these commands will be executed.
  commands:
    - "make update_dot_env"
    - "make -C images/demo_ui build_src update_image_build"

  # A list of files/paths and file name patterns to monitor.
  searches:
    # Not used. Just nice to see.
    - name: 'static'
      # A list of paths to directories or files.
      # Note: A single string is recognized as a short form of a list of one string.
      paths:
        - "images/demo_ui/apps/*/src"

      # Optional. If given, the full path must match this python regular expression.
      # You could include directories in these patterns, but if possible, don't, I think.
      patterns:
        - '.*\.js$'
        - '.*\.jsx$'
        - '.*\.ts$'
        - '.*\.tsx$'
        - '.*\.css$'
        - '.*\.html$'
        - '.*\.py$'
        - '.*\.php$'

    # A search example without patterns.
    - name: 'environment'
      paths: ['.env', '.secrets.env']

"UI Mounted":
  # When a file/path changes, these commands will be executed.
  commands:
    - "make update_dot_env"
    - "make -C images/demo_ui build_mounted"

  searches:
    - name: 'Makefile'
      paths:
        - "images/demo_ui/apps/*/Makefile"
        - "images/demo_ui/Makefile"


# This is the start of a declaration of files/paths to monitor and commands to execute.
"UI Static":

  # When a file/path changes, these commands will be executed.
  commands:
    - "make -C images/demo_ui build_static update_image_build"

  # A list of files/paths and file name patterns to monitor.
  searches:
    # Not used. Just nice to see.
    - name: 'static'
      # A list of paths to directories or files.
      # Note: A single string is recognized as a short form of a list of one string.
      paths:
        - "images/demo_ui/apps/*/static"

# For reloading this YAML file.
# Note: Reloads happen every time changes are discovered.
"monitorBuild YAML Changed":
  commands: "bin/say.py  'Reloading monitorBuild YAML.' 2>/dev/null"
  searches: 'bin/monitorBuild.yaml'

